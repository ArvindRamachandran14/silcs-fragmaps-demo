# M5.2c Wireframe Parity Investigation

Status: Deferred  
Owner: Next available agent after current milestone flow (`M5.3` -> `M5.6`)  
Created: 2026-02-16

## Symptoms Observed
- Visual mismatch remains between:
  - official SILCS GUI screenshot (`docs/screenshots/GUI/GUI_3fly_ligand_apolar_fragmap.png`)
  - current demo screenshot (`docs/screenshots/Bugs/3fly_ligand_fragmaps_apolar.png`)
- Compared scenario target:
  - same ligand context (`3fly_cryst_lig`)
  - protein hidden
  - apolar map visible (`3fly.apolar.gfe.dx`)
  - default iso target (`-1.0` kcal/mol per spec)
- Mismatch appears as different pocket extents/fragment shapes, not just line thickness.

## Hypotheses Considered
1. Wireframe render parameters are the main cause (`opacity`, `opaqueBack`, edge visibility profile).
2. Iso-level convention mismatch (value, sign convention, or threshold interpretation).
3. Map dataset/version mismatch (official tutorial may use different `.dx` files than repo assets).
4. Renderer/pipeline differences between official app and NGL runtime defaults.
5. Camera/context mismatch during screenshot capture (orientation/zoom/clipping depth).
6. Incorrect `.dx` parsing path in our implementation.

## What We Ruled Out
- No custom `.dx` parser exists in our runtime path.
  - FragMap files are passed directly to NGL via `stage.loadFile(resolveRuntimeUrl(options.dxUrl), ...)`.
  - Representation is created by NGL (`component.addRepresentation("surface", {... wireframe: true ...})`).
  - Reference: `src/viewer/nglStage.ts`.
- Map IDs/labels and canonical apolar default iso contract are aligned to the current spec.
  - Reference: `docs/specs/fragmap-controls-spec.md`.
- Representation family is already triangulated wireframe surface (not translucent blob mode).

## Open Hypotheses (Not Yet Resolved)
- Official screenshot may be generated from a different map bundle/version than current assets.
- Iso parity may require additional normalization conventions beyond current default values.
- NGL surface triangulation/rendering behavior may differ from the official GUI renderer.
- Minor camera clipping/projection differences may amplify perceived shape deltas.

## Repro Steps + Exact Commands
1. Confirm working tree context:
```bash
git status --short
```
2. Reconfirm slice-level regression baseline:
```bash
npm run validate:m5.2c
```
3. Confirm runtime map load/representation path is NGL-native (no custom parser):
```bash
rg -n "stage.loadFile\\(resolveRuntimeUrl\\(options\\.dxUrl\\)|addRepresentation\\(\"surface\"" src/viewer/nglStage.ts
```
4. Launch app and manually reproduce screenshot conditions:
```bash
npm run serve
```
5. In `/viewer`:
- Hide protein (`Show Protein` unchecked).
- Enable `Generic Apolar` only.
- Use default iso setting for apolar (`-1.0` kcal/mol contract).
- Orient/zoom to ligand neighborhood and capture screenshot.

## Resume Checklist (First 3 Commands)
```bash
git status --short
npm run validate:m5.2c
npm run serve
```

## Suggested Next Parity Probe (when resumed)
1. Verify whether official tutorial used the exact same `.dx` files (checksum/metadata comparison if source assets are obtainable).
2. Capture side-by-side screenshots at matched camera pose and report contour differences with annotations.
3. Only then decide whether further renderer tuning or parser-level investigation is justified.

<svg xmlns="http://www.w3.org/2000/svg" width="1900" height="1540" viewBox="0 0 1900 1540" role="img" aria-labelledby="title desc">
  <title id="title">M5.4 per-map iso controls states</title>
  <desc id="desc">M5.4 Prompt A preview showing default, loading, empty, error, and success states for per-map iso controls with Exclusion row non-editable.</desc>
  <defs>
    <style>
      .bg { fill: #f4f5f7; }
      .card { fill: #ffffff; stroke: #cfd8dc; stroke-width: 1.5; }
      .heading { font: 700 22px Arial, sans-serif; fill: #102027; }
      .subhead { font: 700 15px Arial, sans-serif; fill: #263238; }
      .body { font: 13px Arial, sans-serif; fill: #37474f; }
      .muted { font: 12px Arial, sans-serif; fill: #607d8b; }
      .button { fill: #eceff1; stroke: #b0bec5; stroke-width: 1; }
      .button-disabled { fill: #f5f5f5; stroke: #d7d7d7; stroke-width: 1; }
      .checkbox { fill: #ffffff; stroke: #607d8b; stroke-width: 1.2; }
      .checkbox-on { fill: #e8f5e9; stroke: #2e7d32; stroke-width: 1.2; }
      .checkbox-disabled { fill: #f5f5f5; stroke: #b0bec5; stroke-width: 1.2; }
      .divider { stroke: #e0e0e0; stroke-width: 1; }
      .helper { fill: #f8fbff; stroke: #bbdefb; stroke-width: 1; }
      .warn { fill: #fff8e1; stroke: #ffcc80; stroke-width: 1; }
      .error { fill: #ffebee; stroke: #ef9a9a; stroke-width: 1; }
      .good { fill: #e8f5e9; stroke: #a5d6a7; stroke-width: 1; }
      .chip { fill: #eceff1; stroke: #b0bec5; stroke-width: 1; }
      .tab-active { fill: #3f51b5; stroke: #2c3a8c; stroke-width: 1; }
      .tab-inactive { fill: #eceff1; stroke: #c7d0d6; stroke-width: 1; }
      .tab-text-active { font: 700 12px Arial, sans-serif; fill: #ffffff; }
      .tab-text { font: 700 12px Arial, sans-serif; fill: #5f6b73; }
      .legend { stroke: #455a64; stroke-width: 0.6; }
      .viewer { fill: #f6f8fa; stroke: #c5d0d9; stroke-width: 1; }
      .mesh-blue { fill: none; stroke: #1976d2; stroke-width: 1.2; }
      .mesh-red { fill: none; stroke: #d32f2f; stroke-width: 1.2; }
      .mesh-green { fill: none; stroke: #2e7d32; stroke-width: 1.2; }
      .mesh-orange { fill: none; stroke: #f57c00; stroke-width: 1.2; }
      .mesh-magenta { fill: none; stroke: #c2185b; stroke-width: 1.2; }
      .mesh-cyan { fill: none; stroke: #0097a7; stroke-width: 1.2; }
      .mesh-yellow { fill: none; stroke: #f9a825; stroke-width: 1.2; }
      .mesh-gray { fill: none; stroke: #9e9e9e; stroke-width: 1.2; }
      .protein { fill: none; stroke: #273b96; stroke-width: 3; stroke-linecap: round; opacity: 0.95; }
      .iso-btn { fill: #eceff1; stroke: #b0bec5; stroke-width: 1; }
      .iso-btn-disabled { fill: #f5f5f5; stroke: #d7d7d7; stroke-width: 1; }
      .iso-val { fill: #ffffff; stroke: #b0bec5; stroke-width: 1; }
      .iso-val-disabled { fill: #f5f5f5; stroke: #d7d7d7; stroke-width: 1; }
      .iso-text { font: 12px 'Courier New', monospace; fill: #37474f; }
      .iso-text-muted { font: 12px 'Courier New', monospace; fill: #90a4ae; }
      .disabled-pill { fill: #f4f6f8; stroke: #d1d8de; stroke-width: 1; }
      .row-title { font: 12px Arial, sans-serif; fill: #263238; }
    </style>
  </defs>

  <rect class="bg" x="0" y="0" width="1900" height="1540"/>
  <text class="heading" x="48" y="44">M5.4 Prompt A: Per-Map Iso Controls (Adjustable Rows Only)</text>
  <text class="muted" x="48" y="68">Scope: add row-level iso controls (- / value / +) with step, clamp/revert behavior. Exclusion remains non-editable. No M5.5 bulk-action or M5.6 reliability changes in this slice.</text>

  <!-- Panel A: Default -->
  <g transform="translate(40,100)">
    <rect class="card" x="0" y="0" width="560" height="650" rx="8"/>
    <text class="subhead" x="20" y="34">A. Default</text>
    <text class="muted" x="20" y="54">Per-map iso controls visible with canonical defaults</text>

    <rect class="tab-active" x="20" y="70" width="92" height="26" rx="5"/>
    <text class="tab-text-active" x="43" y="87">FragMap</text>
    <rect class="tab-inactive" x="118" y="70" width="80" height="26" rx="5"/>
    <text class="tab-text" x="143" y="87">Ligand</text>

    <rect class="button" x="20" y="108" width="95" height="30" rx="5"/>
    <text class="body" x="39" y="128">Hide all</text>
    <rect class="button" x="125" y="108" width="120" height="30" rx="5"/>
    <text class="body" x="146" y="128">Reset defaults</text>
    <rect class="button" x="255" y="108" width="95" height="30" rx="5"/>
    <text class="body" x="276" y="128">Reset view</text>

    <line class="divider" x1="20" y1="154" x2="540" y2="154"/>
    <text class="subhead" x="20" y="178">Primary</text>

    <rect class="checkbox" x="20" y="194" width="16" height="16"/>
    <circle class="legend" cx="54" cy="202" r="6" fill="#1976d2"/>
    <text class="row-title" x="68" y="206">Generic Donor</text>
    <rect class="iso-btn" x="300" y="190" width="24" height="20" rx="4"/>
    <text class="body" x="309" y="205">-</text>
    <rect class="iso-val" x="330" y="190" width="64" height="20" rx="4"/>
    <text class="iso-text" x="346" y="204">-0.8</text>
    <rect class="iso-btn" x="400" y="190" width="24" height="20" rx="4"/>
    <text class="body" x="408" y="205">+</text>

    <rect class="checkbox" x="20" y="226" width="16" height="16"/>
    <circle class="legend" cx="54" cy="234" r="6" fill="#d32f2f"/>
    <text class="row-title" x="68" y="238">Generic Acceptor</text>
    <rect class="iso-btn" x="300" y="222" width="24" height="20" rx="4"/>
    <text class="body" x="309" y="237">-</text>
    <rect class="iso-val" x="330" y="222" width="64" height="20" rx="4"/>
    <text class="iso-text" x="346" y="236">-0.8</text>
    <rect class="iso-btn" x="400" y="222" width="24" height="20" rx="4"/>
    <text class="body" x="408" y="237">+</text>

    <rect class="checkbox" x="20" y="258" width="16" height="16"/>
    <circle class="legend" cx="54" cy="266" r="6" fill="#2e7d32"/>
    <text class="row-title" x="68" y="270">Generic Apolar</text>
    <rect class="iso-btn" x="300" y="254" width="24" height="20" rx="4"/>
    <text class="body" x="309" y="269">-</text>
    <rect class="iso-val" x="330" y="254" width="64" height="20" rx="4"/>
    <text class="iso-text" x="346" y="268">-1.0</text>
    <rect class="iso-btn" x="400" y="254" width="24" height="20" rx="4"/>
    <text class="body" x="408" y="269">+</text>

    <line class="divider" x1="20" y1="292" x2="540" y2="292"/>
    <text class="subhead" x="20" y="318">Advanced (expanded)</text>

    <rect class="checkbox" x="20" y="334" width="16" height="16"/>
    <circle class="legend" cx="54" cy="342" r="6" fill="#f57c00"/>
    <text class="row-title" x="68" y="346">Positively Charged</text>
    <rect class="iso-btn" x="300" y="330" width="24" height="20" rx="4"/>
    <text class="body" x="309" y="345">-</text>
    <rect class="iso-val" x="330" y="330" width="64" height="20" rx="4"/>
    <text class="iso-text" x="346" y="344">-1.2</text>
    <rect class="iso-btn" x="400" y="330" width="24" height="20" rx="4"/>
    <text class="body" x="408" y="345">+</text>

    <rect class="checkbox" x="20" y="366" width="16" height="16"/>
    <circle class="legend" cx="54" cy="374" r="6" fill="#9e9e9e"/>
    <text class="row-title" x="68" y="378">Exclusion Map</text>
    <rect class="disabled-pill" x="330" y="362" width="94" height="20" rx="10"/>
    <text class="muted" x="354" y="376">iso disabled</text>

    <rect class="helper" x="20" y="400" width="520" height="106" rx="6"/>
    <text class="body" x="36" y="426">Numeric contract (M5.4): step 0.1, min -3.0, max 0.0, precision 1.</text>
    <text class="muted" x="36" y="448">Typed invalid input reverts to last valid value for that row.</text>
    <text class="muted" x="36" y="470">No global iso control appears anywhere in this slice.</text>
  </g>

  <!-- Panel B: Loading -->
  <g transform="translate(670,100)">
    <rect class="card" x="0" y="0" width="560" height="650" rx="8"/>
    <text class="subhead" x="20" y="34">B. Loading</text>
    <text class="muted" x="20" y="54">Single-row iso update in progress while map update resolves</text>

    <rect class="tab-active" x="20" y="70" width="92" height="26" rx="5"/>
    <text class="tab-text-active" x="43" y="87">FragMap</text>
    <rect class="tab-inactive" x="118" y="70" width="80" height="26" rx="5"/>
    <text class="tab-text" x="143" y="87">Ligand</text>

    <rect class="button-disabled" x="20" y="108" width="95" height="30" rx="5"/>
    <text class="muted" x="39" y="128">Hide all</text>
    <rect class="button-disabled" x="125" y="108" width="120" height="30" rx="5"/>
    <text class="muted" x="146" y="128">Reset defaults</text>
    <rect class="button-disabled" x="255" y="108" width="95" height="30" rx="5"/>
    <text class="muted" x="276" y="128">Reset view</text>

    <line class="divider" x1="20" y1="154" x2="540" y2="154"/>
    <text class="subhead" x="20" y="178">Primary</text>

    <rect class="checkbox-on" x="20" y="194" width="16" height="16"/>
    <text class="body" x="24" y="207">✓</text>
    <circle class="legend" cx="54" cy="202" r="6" fill="#1976d2"/>
    <text class="row-title" x="68" y="206">Generic Donor</text>
    <rect class="iso-btn-disabled" x="300" y="190" width="24" height="20" rx="4"/>
    <text class="muted" x="309" y="205">-</text>
    <rect class="iso-val-disabled" x="330" y="190" width="64" height="20" rx="4"/>
    <text class="iso-text-muted" x="342" y="204">-0.7</text>
    <rect class="iso-btn-disabled" x="400" y="190" width="24" height="20" rx="4"/>
    <text class="muted" x="408" y="205">+</text>

    <rect class="checkbox" x="20" y="226" width="16" height="16"/>
    <circle class="legend" cx="54" cy="234" r="6" fill="#2e7d32"/>
    <text class="row-title" x="68" y="238">Generic Apolar</text>
    <rect class="iso-btn" x="300" y="222" width="24" height="20" rx="4"/>
    <text class="body" x="309" y="237">-</text>
    <rect class="iso-val" x="330" y="222" width="64" height="20" rx="4"/>
    <text class="iso-text" x="346" y="236">-1.0</text>
    <rect class="iso-btn" x="400" y="222" width="24" height="20" rx="4"/>
    <text class="body" x="408" y="237">+</text>

    <rect class="warn" x="20" y="262" width="520" height="104" rx="6"/>
    <text class="body" x="36" y="288">Updating Generic Donor iso to -0.7...</text>
    <text class="muted" x="36" y="310">Only the active row controls are temporarily disabled.</text>
    <text class="muted" x="36" y="332">Camera and other rows remain unchanged.</text>

    <rect class="viewer" x="20" y="382" width="520" height="124" rx="6"/>
    <text class="muted" x="32" y="406">Viewer placeholder during row-scoped iso update.</text>
  </g>

  <!-- Panel C: Empty -->
  <g transform="translate(1300,100)">
    <rect class="card" x="0" y="0" width="560" height="650" rx="8"/>
    <text class="subhead" x="20" y="34">C. Empty</text>
    <text class="muted" x="20" y="54">No maps visible; per-map iso values remain editable and stored</text>

    <rect class="tab-active" x="20" y="70" width="92" height="26" rx="5"/>
    <text class="tab-text-active" x="43" y="87">FragMap</text>
    <rect class="tab-inactive" x="118" y="70" width="80" height="26" rx="5"/>
    <text class="tab-text" x="143" y="87">Ligand</text>

    <line class="divider" x1="20" y1="154" x2="540" y2="154"/>
    <text class="subhead" x="20" y="178">Primary</text>

    <rect class="checkbox" x="20" y="194" width="16" height="16"/>
    <circle class="legend" cx="54" cy="202" r="6" fill="#1976d2"/>
    <text class="row-title" x="68" y="206">Generic Donor</text>
    <rect class="iso-btn" x="300" y="190" width="24" height="20" rx="4"/>
    <text class="body" x="309" y="205">-</text>
    <rect class="iso-val" x="330" y="190" width="64" height="20" rx="4"/>
    <text class="iso-text" x="346" y="204">-0.6</text>
    <rect class="iso-btn" x="400" y="190" width="24" height="20" rx="4"/>
    <text class="body" x="408" y="205">+</text>

    <rect class="checkbox" x="20" y="226" width="16" height="16"/>
    <circle class="legend" cx="54" cy="234" r="6" fill="#d32f2f"/>
    <text class="row-title" x="68" y="238">Generic Acceptor</text>
    <rect class="iso-btn" x="300" y="222" width="24" height="20" rx="4"/>
    <text class="body" x="309" y="237">-</text>
    <rect class="iso-val" x="330" y="222" width="64" height="20" rx="4"/>
    <text class="iso-text" x="346" y="236">-1.0</text>
    <rect class="iso-btn" x="400" y="222" width="24" height="20" rx="4"/>
    <text class="body" x="408" y="237">+</text>

    <rect class="helper" x="20" y="262" width="520" height="118" rx="6"/>
    <text class="body" x="36" y="288">No visible FragMaps.</text>
    <text class="muted" x="36" y="310">Row iso values are still editable and persist for next toggle-on.</text>
    <text class="muted" x="36" y="332">No forced map load is triggered by editing hidden rows.</text>
    <text class="muted" x="36" y="354">Exclusion row stays non-editable in all states.</text>

    <rect class="viewer" x="20" y="398" width="520" height="108" rx="6"/>
    <path class="protein" d="M44 484 C108 416, 172 496, 236 426 C292 384, 366 470, 516 414"/>
    <text class="muted" x="32" y="420">Viewer remains clear while map count is zero.</text>
  </g>

  <!-- Panel D: Error -->
  <g transform="translate(40,820)">
    <rect class="card" x="0" y="0" width="905" height="680" rx="8"/>
    <text class="subhead" x="20" y="34">D. Error</text>
    <text class="muted" x="20" y="54">Invalid or out-of-range iso input handled per row without global impact</text>

    <rect class="tab-active" x="20" y="70" width="92" height="26" rx="5"/>
    <text class="tab-text-active" x="43" y="87">FragMap</text>
    <rect class="tab-inactive" x="118" y="70" width="80" height="26" rx="5"/>
    <text class="tab-text" x="143" y="87">Ligand</text>

    <rect class="error" x="20" y="108" width="865" height="74" rx="6"/>
    <text class="body" x="36" y="132">Typed value 'abc' for Generic Acceptor is invalid -> reverted to last valid -0.8.</text>
    <text class="muted" x="36" y="154">Typed value -3.8 for Generic Donor clamps to min -3.0 (row-local behavior).</text>
    <text class="muted" x="36" y="174">Other rows and camera remain unchanged; no route reload.</text>

    <rect class="viewer" x="20" y="198" width="470" height="286" rx="6"/>
    <path class="protein" d="M48 430 C108 260, 170 440, 230 280 C280 212, 330 390, 450 252"/>
    <polyline class="mesh-blue" points="128,366 166,338 220,366 190,416 132,404 128,366"/>
    <line class="mesh-blue" x1="166" y1="338" x2="190" y2="416"/>
    <line class="mesh-blue" x1="132" y1="404" x2="220" y2="366"/>
    <text class="muted" x="32" y="220">Viewer stays stable through input clamp/revert handling.</text>

    <line class="divider" x1="510" y1="198" x2="885" y2="198"/>
    <text class="subhead" x="510" y="224">Primary rows</text>

    <rect class="checkbox-on" x="510" y="240" width="16" height="16"/>
    <text class="body" x="514" y="253">✓</text>
    <circle class="legend" cx="544" cy="248" r="6" fill="#1976d2"/>
    <text class="row-title" x="558" y="252">Generic Donor</text>
    <rect class="iso-btn" x="748" y="236" width="24" height="20" rx="4"/>
    <text class="body" x="757" y="251">-</text>
    <rect class="iso-val" x="778" y="236" width="64" height="20" rx="4"/>
    <text class="iso-text" x="792" y="250">-3.0</text>
    <rect class="iso-btn" x="848" y="236" width="24" height="20" rx="4"/>
    <text class="body" x="856" y="251">+</text>

    <rect class="checkbox" x="510" y="272" width="16" height="16"/>
    <circle class="legend" cx="544" cy="280" r="6" fill="#d32f2f"/>
    <text class="row-title" x="558" y="284">Generic Acceptor</text>
    <rect class="iso-btn" x="748" y="268" width="24" height="20" rx="4"/>
    <text class="body" x="757" y="283">-</text>
    <rect class="iso-val" x="778" y="268" width="64" height="20" rx="4"/>
    <text class="iso-text" x="792" y="282">-0.8</text>
    <rect class="iso-btn" x="848" y="268" width="24" height="20" rx="4"/>
    <text class="body" x="856" y="283">+</text>

    <rect class="chip" x="510" y="308" width="375" height="28" rx="14"/>
    <text class="muted" x="522" y="327">Per-map guardrails only. Retry UX remains deferred to M5.6.</text>
  </g>

  <!-- Panel E: Success -->
  <g transform="translate(985,820)">
    <rect class="card" x="0" y="0" width="875" height="680" rx="8"/>
    <text class="subhead" x="20" y="34">E. Success</text>
    <text class="muted" x="20" y="54">Visible maps update with row-level iso changes; Exclusion stays fixed/non-editable</text>

    <rect class="tab-active" x="20" y="70" width="92" height="26" rx="5"/>
    <text class="tab-text-active" x="43" y="87">FragMap</text>
    <rect class="tab-inactive" x="118" y="70" width="80" height="26" rx="5"/>
    <text class="tab-text" x="143" y="87">Ligand</text>

    <rect class="viewer" x="20" y="108" width="510" height="340" rx="6"/>
    <path class="protein" d="M42 404 C96 234, 170 438, 234 268 C296 198, 370 350, 506 224"/>

    <polyline class="mesh-green" points="112,330 146,306 198,332 164,392 116,378 112,330"/>
    <line class="mesh-green" x1="146" y1="306" x2="164" y2="392"/>
    <line class="mesh-green" x1="116" y1="378" x2="198" y2="332"/>

    <polyline class="mesh-orange" points="210,306 248,282 298,308 264,366 216,350 210,306"/>
    <line class="mesh-orange" x1="248" y1="282" x2="264" y2="366"/>
    <line class="mesh-orange" x1="216" y1="350" x2="298" y2="308"/>

    <polyline class="mesh-yellow" points="296,354 330,330 376,356 346,412 300,396 296,354"/>
    <line class="mesh-yellow" x1="330" y1="330" x2="346" y2="412"/>
    <line class="mesh-yellow" x1="300" y1="396" x2="376" y2="356"/>

    <polyline class="mesh-gray" points="382,326 416,302 460,330 430,388 386,372 382,326"/>
    <line class="mesh-gray" x1="416" y1="302" x2="430" y2="388"/>
    <line class="mesh-gray" x1="386" y1="372" x2="460" y2="330"/>

    <text class="muted" x="34" y="130">Updated iso values applied in place to visible wireframe maps.</text>

    <line class="divider" x1="550" y1="108" x2="855" y2="108"/>
    <text class="subhead" x="550" y="136">Rows with active iso controls</text>

    <rect class="checkbox-on" x="550" y="156" width="16" height="16"/>
    <text class="body" x="554" y="169">✓</text>
    <circle class="legend" cx="584" cy="164" r="6" fill="#2e7d32"/>
    <text class="row-title" x="598" y="168">Generic Apolar</text>
    <rect class="iso-btn" x="744" y="152" width="24" height="20" rx="4"/>
    <text class="body" x="753" y="167">-</text>
    <rect class="iso-val" x="774" y="152" width="64" height="20" rx="4"/>
    <text class="iso-text" x="790" y="166">-1.1</text>
    <rect class="iso-btn" x="844" y="152" width="24" height="20" rx="4"/>
    <text class="body" x="852" y="167">+</text>

    <rect class="checkbox-on" x="550" y="188" width="16" height="16"/>
    <text class="body" x="554" y="201">✓</text>
    <circle class="legend" cx="584" cy="196" r="6" fill="#f57c00"/>
    <text class="row-title" x="598" y="200">Positively Charged</text>
    <rect class="iso-btn" x="744" y="184" width="24" height="20" rx="4"/>
    <text class="body" x="753" y="199">-</text>
    <rect class="iso-val" x="774" y="184" width="64" height="20" rx="4"/>
    <text class="iso-text" x="790" y="198">-1.0</text>
    <rect class="iso-btn" x="844" y="184" width="24" height="20" rx="4"/>
    <text class="body" x="852" y="199">+</text>

    <rect class="checkbox-on" x="550" y="220" width="16" height="16"/>
    <text class="body" x="554" y="233">✓</text>
    <circle class="legend" cx="584" cy="228" r="6" fill="#f9a825"/>
    <text class="row-title" x="598" y="232">Water Oxygen</text>
    <rect class="iso-btn" x="744" y="216" width="24" height="20" rx="4"/>
    <text class="body" x="753" y="231">-</text>
    <rect class="iso-val" x="774" y="216" width="64" height="20" rx="4"/>
    <text class="iso-text" x="790" y="230">-0.2</text>
    <rect class="iso-btn" x="844" y="216" width="24" height="20" rx="4"/>
    <text class="body" x="852" y="231">+</text>

    <rect class="checkbox-on" x="550" y="252" width="16" height="16"/>
    <text class="body" x="554" y="265">✓</text>
    <circle class="legend" cx="584" cy="260" r="6" fill="#9e9e9e"/>
    <text class="row-title" x="598" y="264">Exclusion Map</text>
    <rect class="disabled-pill" x="744" y="248" width="128" height="20" rx="10"/>
    <text class="muted" x="780" y="262">iso disabled (fixed)</text>

    <rect class="good" x="550" y="288" width="305" height="94" rx="6"/>
    <text class="body" x="566" y="314">M5.4 success contract:</text>
    <text class="muted" x="566" y="336">Row-level iso edits update only the targeted map.</text>
    <text class="muted" x="566" y="356">No global iso control; Exclusion remains non-editable.</text>
  </g>
</svg>
